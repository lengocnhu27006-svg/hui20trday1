<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n L√Ω H·ª•i</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{color:#2c3e50;margin-bottom:3px}
.sub{color:#555;margin-bottom:8px;font-style:italic}
.chuHui{color:#c0392b;font-weight:bold;margin-bottom:10px}
.info{background:#fff;padding:10px;border-radius:6px;margin-bottom:10px}

table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#3498db;color:#fff}

tr.daDong{background:#e8f8f5}
tr.chuaDong{background:#fdecea}

button{padding:6px 10px;border:none;border-radius:4px;cursor:pointer}
.them{background:#27ae60;color:#fff}
.hot{background:#f39c12;color:#fff}
.xoa{background:#e74c3c;color:#fff}
.ky{background:#8e44ad;color:#fff}

.daHot{color:red;font-weight:bold}
.chet{color:#555;font-style:italic}
.khoa{color:#aaa;font-style:italic}
.tongHot{margin-top:10px;font-size:16px;font-weight:bold}
</style>
</head>

<body>

<h2>üìã QU·∫¢N L√ù H·ª§I</h2>
<div class="sub">H·ª•i 5.000.000 ƒë / 1 th√°ng</div>
<div class="chuHui">Ch·ªß h·ª•i: Nguy·ªÖn H·∫±ng Ni</div>

<div class="info">
<b>K·ª≥:</b>
<button class="ky" onclick="doiKy(-1)">‚¨Ö</button>
<input id="ky" type="number" value="1" style="width:60px" onchange="capNhatKy()">
<button class="ky" onclick="doiKy(1)">‚û°</button>
&nbsp;&nbsp;
<b>Ng√†y khui:</b>
<input type="date" id="ngayKhui" onchange="capNhatNgay()">
</div>

<button class="them" onclick="themNguoi()">‚ûï Th√™m ng∆∞·ªùi</button>
<button class="xoa" onclick="resetHui()">üîÑ Reset ch∆∞ng h·ª•i m·ªõi</button>
<button class="them" onclick="inBill()">üßæ In bill PDF</button>

<table>
<thead>
<tr>
  <th>T√™n</th>
  <th>ƒê√£ ƒë√≥ng</th>
  <th>S·ªë ti·ªÅn</th>
  <th>B·ªè thƒÉm</th>
  <th>H·ªët</th>
  <th>Xo√°</th>
</tr>
</thead>
<tbody id="bang"></tbody>
</table>

<div class="tongHot" id="tongHot"></div>

<script>
const TIEN_HUI = 5000000;
let data={ky:1,ngay:{},tongHot:{},danhSach:[]};

// ===== ti·ªán √≠ch =====
function daChet(n){
  return Object.values(n.lichSu).some(ls=>ls.daHot);
}

// ===== K·ª≤ =====
function capNhatKy(){
  data.ky=Math.max(1,parseInt(ky.value)||1);
  veBang();
}
function doiKy(s){
  data.ky=Math.max(1,data.ky+s);
  ky.value=data.ky;
  veBang();
}
function capNhatNgay(){
  data.ngay[data.ky]=ngayKhui.value;
}

// ===== NG∆Ø·ªúI =====
function themNguoi(){
  data.danhSach.push({ten:"Ng∆∞·ªùi "+(data.danhSach.length+1),lichSu:{}});
  veBang();
}
function xoaNguoi(i){
  if(daChet(data.danhSach[i]))
    return alert("‚ùå Ch∆∞ng ch·∫øt kh√¥ng ƒë∆∞·ª£c xo√°");
  if(confirm("Xo√° ng∆∞·ªùi n√†y?")){
    data.danhSach.splice(i,1);
    veBang();
  }
}

// ===== ƒê√ìNG =====
function tickDong(i){
  let ls=data.danhSach[i].lichSu[data.ky];
  if(ls){ls.daDong=!ls.daDong;veBang();}
}

// ===== H·ªêT =====
function hotHui(i){
  let ky=data.ky;
  let nguoi=data.danhSach[i];

  if(daChet(nguoi))
    return alert("Ng∆∞·ªùi n√†y ƒë√£ h·ªët ‚Üí ch∆∞ng ch·∫øt");

  for(let n of data.danhSach)
    if(n.lichSu[ky]?.daHot)
      return alert("K·ª≥ n√†y ƒë√£ c√≥ ng∆∞·ªùi h·ªët");

  let bo=parseInt(prompt("Nh·∫≠p ti·ªÅn b·ªè thƒÉm:"));
  if(isNaN(bo)||bo<0) return alert("Ti·ªÅn kh√¥ng h·ª£p l·ªá");

  let tongHot=0;

  data.danhSach.forEach((n,idx)=>{
    if(!n.lichSu[ky])
      n.lichSu[ky]={dong:0,daDong:false,daHot:false,boTham:0};

    if(idx===i){
      n.lichSu[ky].daHot=true;
      n.lichSu[ky].boTham=bo;
      n.lichSu[ky].dong=0;
    }else if(daChet(n)){
      n.lichSu[ky].dong=TIEN_HUI;
      tongHot+=TIEN_HUI;
    }else{
      let dong=TIEN_HUI-bo;
      n.lichSu[ky].dong=dong;
      tongHot+=dong;
    }
  });

  data.tongHot[ky]=tongHot;
  alert("üí∞ Ng∆∞·ªùi n√†y h·ªët ƒë∆∞·ª£c: "+tongHot.toLocaleString()+" ƒë");
  veBang();
}

// ===== RESET =====
function resetHui(){
  if(!confirm("Reset to√†n b·ªô d·ªØ li·ªáu?"))return;
  data={ky:1,ngay:{},tongHot:{},danhSach:[]};
  ky.value=1;ngayKhui.value="";
  veBang();
}

// ===== IN BILL =====
function inBill(){
  let k=data.ky;
  let html=`<h2>PHI·∫æU H·ª§I - K·ª≤ ${k}</h2>
  <table border="1" cellpadding="6" width="100%">
  <tr><th>T√™n</th><th>S·ªë ti·ªÅn</th><th>B·ªè thƒÉm</th><th>Ghi ch√∫</th></tr>`;
  data.danhSach.forEach(n=>{
    let ls=n.lichSu[k];
    html+=`<tr>
      <td>${n.ten}</td>
      <td>${ls?ls.dong.toLocaleString():""}</td>
      <td>${ls?.boTham?ls.boTham.toLocaleString():""}</td>
      <td>${ls?.daHot?"H·ªêT":daChet(n)?"CH∆ØNG CH·∫æT":"CH∆ØNG S·ªêNG"}</td>
    </tr>`;
  });
  html+=`</table><h3>T·ªïng h·ªët: ${data.tongHot[k]?.toLocaleString()||0} ƒë</h3>`;
  let w=window.open("","","width=800,height=600");
  w.document.write(html);w.document.close();w.print();
}

// ===== V·∫º =====
function veBang(){
  let k=data.ky;
  ky.value=k;
  ngayKhui.value=data.ngay[k]||"";

  let html="";
  data.danhSach.forEach((n,i)=>{
    let ls=n.lichSu[k];
    let chet=daChet(n);

    if(chet && !ls){
      n.lichSu[k]={dong:TIEN_HUI,daDong:false,daHot:false,boTham:0};
      ls=n.lichSu[k];
    }

    html+=`
    <tr class="${ls?.daDong?'daDong':'chuaDong'}">
      <td><input value="${n.ten}" oninput="data.danhSach[${i}].ten=this.value"></td>
      <td>${ls?`<input type="checkbox" ${ls.daDong?'checked':''} onclick="tickDong(${i})">`:""}</td>
      <td>${ls?ls.dong.toLocaleString()+" ƒë":""}</td>
      <td>${ls?.boTham?ls.boTham.toLocaleString()+" ƒë":""}</td>
      <td>
        ${ls?.daHot?`<span class="daHot">ƒê√£ h·ªët</span>`:
          chet?`<span class="chet">Ch∆∞ng ch·∫øt</span>`:
          `<button class="hot" onclick="hotHui(${i})">H·ªët</button>`}
      </td>
      <td>
        ${chet?`<span class="khoa">Kho√°</span>`:
        `<button class="xoa" onclick="xoaNguoi(${i})">‚ùå</button>`}
      </td>
    </tr>`;
  });

  bang.innerHTML=html;
  tongHot.innerHTML=data.tongHot[k]
    ?`üí∞ T·ªïng ti·ªÅn ng∆∞·ªùi h·ªët nh·∫≠n: <b>${data.tongHot[k].toLocaleString()} ƒë</b>`:"";
}

veBang();
</script>

</body>
</html>
