<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n L√Ω H·ª•i</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{color:#2c3e50;margin-bottom:3px}
.sub{color:#555;margin-bottom:8px;font-style:italic}
.chuHui{color:#c0392b;font-weight:bold;margin-bottom:10px}
.info{background:#fff;padding:10px;border-radius:6px;margin-bottom:10px}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#3498db;color:#fff}
tr.daDong{background:#e8f8f5}
tr.chuaDong{background:#fdecea}
button{padding:6px 10px;border:none;border-radius:4px;cursor:pointer}
.them{background:#27ae60;color:#fff}
.hot{background:#f39c12;color:#fff}
.xoa{
  background:linear-gradient(135deg,#ff4d4d,#c0392b);
  color:#fff;
  font-weight:bold;
  box-shadow:0 3px 6px rgba(0,0,0,.25)
}
.ky{background:#8e44ad;color:#fff}
.daHot{color:red;font-weight:bold}
.khoa{color:#999;font-style:italic}
.tongHot{margin-top:10px;font-size:16px;font-weight:bold}
.song{color:#27ae60;font-weight:bold}
.chet{color:#7f8c8d;font-weight:bold}
.hotNguoi{color:#e74c3c;font-weight:bold}

</style>
</head>

<body>

<h2>üìã QU·∫¢N L√ù H·ª§I</h2>
<div class="sub">H·ª•i 5.000.000 ƒë / 1 th√°ng</div>
<div class="chuHui">Ch·ªß h·ª•i: Nguy·ªÖn H·∫±ng Ni</div>

<div class="info">
<b>K·ª≥:</b>
<button class="ky" onclick="doiKy(-1)">‚¨Ö</button>
<input type="number" id="ky" value="1" onchange="capNhatKy()">
<button class="ky" onclick="doiKy(1)">‚û°</button>
&nbsp;&nbsp;
<b>Ng√†y khui:</b>
<input type="date" id="ngayKhui" onchange="capNhatNgay()">
</div>

<button class="them" onclick="themNguoi()" id="btnThem">‚ûï Th√™m ng∆∞·ªùi</button>
<button class="ky" onclick="xuatPDF()">üì§ Xu·∫•t PDF g·ª≠i Zalo</button>
<button class="xoa" onclick="resetHui()" id="btnReset">‚ôª Reset d√¢y h·ª•i</button>

<table>
<thead>
<tr>
<th>T√™n</th>
<th>ƒê√£ ƒë√≥ng</th>
<th>Ti·ªÅn ƒë√≥ng</th>
<th>B·ªè thƒÉm</th>
<th>H·ªët</th>
<th>Xo√°</th>
</tr>
</thead>
<tbody id="bang"></tbody>
</table>

<div class="tongHot" id="tongHot"></div>

<script>
const TIEN_HUI = 5000000;
let laChuHui = true; // ‚ùó ƒë·ªïi false khi g·ª≠i cho ng∆∞·ªùi kh√°c

let data = {
  ky:1,
  ngay:{},
  tongHot:{},
  danhSach:[]
};

function luuDuLieu(){
  localStorage.setItem("huiData",JSON.stringify(data));
}
function taiDuLieu(){
  let d=localStorage.getItem("huiData");
  if(d) data=JSON.parse(d);
}

function capNhatKy(){
  if(!laChuHui) return;
  let v=parseInt(ky.value); if(v<1) v=1;
  data.ky=v; luuDuLieu(); veBang();
}
function doiKy(s){
  if(!laChuHui) return;
  data.ky+=s; if(data.ky<1) data.ky=1;
  ky.value=data.ky; luuDuLieu(); veBang();
}
function capNhatNgay(){
  if(!laChuHui) return;
  data.ngay[data.ky]=ngayKhui.value; luuDuLieu();
}

function themNguoi(){
  if(!laChuHui) return;
  data.danhSach.push({ten:"Ng∆∞·ªùi "+(data.danhSach.length+1),lichSu:{}});
  luuDuLieu(); veBang();
}

function xoaNguoi(i){
  if(!laChuHui) return;
  if(daChet(data.danhSach[i])) return alert("Ch∆∞ng ch·∫øt kh√¥ng ƒë∆∞·ª£c xo√°");
  if(confirm("Xo√° ng∆∞·ªùi n√†y?")){
    data.danhSach.splice(i,1);
    luuDuLieu(); veBang();
  }
}

function daChet(n){
  for(let k in n.lichSu) if(n.lichSu[k].daHot) return true;
  return false;
}

function tickDong(i){
  if(!laChuHui) return;
  let ls=data.danhSach[i].lichSu[data.ky];
  if(ls){ ls.daDong=!ls.daDong; luuDuLieu(); veBang(); }
}

function hotHui(i){
  if(!laChuHui) return;
  let ky=data.ky;
  let bo=parseInt(prompt("Nh·∫≠p ti·ªÅn b·ªè thƒÉm:"));
  if(isNaN(bo)||bo<0) return;

  data.danhSach.forEach(n=>{
    if(!n.lichSu[ky]) n.lichSu[ky]={dong:TIEN_HUI,daDong:false,daHot:false,boTham:0};
  });

  data.danhSach[i].lichSu[ky].daHot=true;
  data.danhSach[i].lichSu[ky].dong=0;
  data.danhSach[i].lichSu[ky].boTham=bo;

  let tong=0;
  data.danhSach.forEach((n,idx)=>{
    if(idx!==i){
      if(!daChet(n)){
        n.lichSu[ky].dong=TIEN_HUI-bo;
      }else{
        n.lichSu[ky].dong=TIEN_HUI;
      }
      tong+=n.lichSu[ky].dong;
    }
  });

  data.tongHot[ky]=tong;
  alert("üí∞ H·ªët ƒë∆∞·ª£c "+tong.toLocaleString()+" ƒë");
  luuDuLieu(); veBang();
}

function veBang(){
  ky.value=data.ky;
  ngayKhui.value=data.ngay[data.ky]||"";
  let html="";
  data.danhSach.forEach((n,i)=>{
    let ls=n.lichSu[data.ky];
    html+=`
    <tr>
    <td><input value="${n.ten}" ${!laChuHui?"disabled":""}
    oninput="data.danhSach[${i}].ten=this.value;luuDuLieu()"></td>
    <td>${ls&&laChuHui?`<input type="checkbox" ${ls.daDong?"checked":""} onclick="tickDong(${i})">`:ls?.daDong?"‚úî":""}</td>
    <td>${ls?ls.dong.toLocaleString()+" ƒë":""}</td>
    <td>${ls?.boTham?ls.boTham.toLocaleString()+" ƒë":""}</td>
    <td>
${
  ls?.daHot
    ? `<span class="hotNguoi">üî• ƒê√É H·ªêT</span>`
    : daChet(n)
      ? `<span class="chet">‚ò† CH∆ØNG CH·∫æT</span>`
      : `<span class="song">‚úî CH∆ØNG S·ªêNG</span>`
}
${laChuHui && !ls?.daHot && !daChet(n)
  ? `<br><button class="hot" onclick="hotHui(${i})">H·ªët</button>`
  : ""}
</td>

    <td>${laChuHui?`<button class="xoa" onclick="xoaNguoi(${i})">‚ùå</button>`:""}</td>
    </tr>`;
  });
  bang.innerHTML=html;
  tongHot.innerHTML=data.tongHot[data.ky]?
  "üí∞ T·ªïng ti·ªÅn ng∆∞·ªùi h·ªët nh·∫≠n: <b>"+data.tongHot[data.ky].toLocaleString()+" ƒë</b>":"";
}

function xuatPDF(){
  let w = window.open();

  w.document.write(`
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Bill H·ª•i</title>

<style>
${document.querySelector("style").innerHTML}
/* ===== STYLE RI√äNG KHI XU·∫§T PDF TR√äN ƒêI·ªÜN THO·∫†I ===== */

body{
  font-size:18px;        /* ‚≠ê ch·ªØ t·ªïng th·ªÉ to h∆°n */
}

h2{
  font-size:26px;
}

.sub{
  font-size:18px;
}

.chuHui{
  font-size:19px;
}

table{
  font-size:18px;
}

th, td{
  font-size:18px;
}

/* ‚ùå ·∫®N C·ªòT XO√Å */
table th:last-child,
table td:last-child{
  display:none !important;
}

/* ‚ùå ·∫®N N√öT B·∫§M */
button{
  display:none !important;
}

/* ===== STYLE RI√äNG CHO PDF (KH√îNG ·∫¢NH H∆Ø·ªûNG GIAO DI·ªÜN) ===== */

body{
  font-size:16px;
  background:#fff;
}

h2{ font-size:22px; }
.sub{ font-size:15px; }
.chuHui{ font-size:16px; }

table{ font-size:15px; }

th{
  background:#2980b9 !important;
  color:#fff !important;
}

tr.daDong{
  background:#d5f5e3 !important;
}

tr.chuaDong{
  background:#fdebd0 !important;
}

/* ‚ùå ·∫®N C·ªòT XO√Å */
table th:last-child,
table td:last-child{
  display:none !important;
}

/* ‚ùå ·∫®N TO√ÄN B·ªò N√öT */
button{
  display:none !important;
}

@media print{
  body{
    -webkit-print-color-adjust:exact;
    print-color-adjust:exact;
  }
}
</style>
</head>

<body>
${document.body.innerHTML}
</body>
</html>
  `);

  w.document.close();
  w.focus();
}

taiDuLieu();
veBang();

if(!laChuHui){
  btnThem.style.display="none";
}
function resetHui(){
  if(!laChuHui) return;

  if(!confirm("‚ö†Ô∏è Reset s·∫Ω xo√° TO√ÄN B·ªò d√¢y h·ª•i. B·∫°n ch·∫Øc ch∆∞a?")) return;

  data = {
    ky: 1,
    ngay: {},
    tongHot: {},
    danhSach: []
  };

  localStorage.removeItem("huiData");
  veBang();
}
if(!laChuHui){
  btnThem.style.display="none";
  btnReset.style.display="none";
}
</script>

</body>
</html>

