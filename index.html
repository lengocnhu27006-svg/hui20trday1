<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n L√Ω H·ª•i</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h2{color:#2c3e50;margin-bottom:3px}
.sub{color:#555;font-style:italic}
.chuHui{color:#c0392b;font-weight:bold;margin-bottom:10px}

.info{background:#fff;padding:10px;border-radius:6px;margin-bottom:10px}

table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#3498db;color:#fff}

tr.daDong{background:#e8f8f5}
tr.chuaDong{background:#fdecea}
tr.chet{background:#eee}

button{padding:6px 10px;border:none;border-radius:4px;cursor:pointer}
.them{background:#27ae60;color:#fff}
.hot{background:#f39c12;color:#fff}
.xoa{background:#e74c3c;color:#fff}
.ky{background:#8e44ad;color:#fff}

.daHot{color:red;font-weight:bold}
.khoa{color:#777;font-style:italic}

.tongHot{margin-top:10px;font-size:16px;font-weight:bold}

/* ===== IN / PDF ===== */
@media print{
*{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important}
body{zoom:1.25}
th{background:#3498db!important;color:#fff!important}
td,th{border:1px solid #000}
}
@page{size:A4 landscape;margin:10mm}
</style>
</head>

<body>

<h2>üìã QU·∫¢N L√ù H·ª§I</h2>
<div class="sub">H·ª•i 5.000.000 ƒë / 1 th√°ng</div>
<div class="chuHui">Ch·ªß h·ª•i: Nguy·ªÖn H·∫±ng Ni</div>

<div class="info">
<b>K·ª≥:</b>
<button class="ky" onclick="doiKy(-1)">‚¨Ö</button>
<input type="number" id="ky" value="1" style="width:60px" onchange="capNhatKy()">
<button class="ky" onclick="doiKy(1)">‚û°</button>

&nbsp;&nbsp;
<b>Ng√†y khui:</b>
<input type="date" id="ngayKhui" onchange="capNhatNgay()">
</div>

<button class="them" onclick="themNguoi()">‚ûï Th√™m ng∆∞·ªùi</button>
<button class="ky" onclick="resetHui()">‚ôª Reset d√¢y h·ª•i</button>
<button class="ky" onclick="inBill()">üñ® In bill</button>
<button class="ky" onclick="xuatPDF()">üì§ Xu·∫•t PDF g·ª≠i Zalo</button>

<table>
<thead>
<tr>
<th>T√™n</th>
<th>ƒê√£ ƒë√≥ng</th>
<th>Ti·ªÅn ƒë√≥ng</th>
<th>B·ªè thƒÉm</th>
<th>H·ªët</th>
<th>Xo√°</th>
</tr>
</thead>
<tbody id="bang"></tbody>
</table>

<div class="tongHot" id="tongHot"></div>

<script>
const TIEN_HUI = 5000000;

let data={ky:1,ngay:{},tongHot:{},danhSach:[]};

/* ===== L∆ØU / T·∫¢I ===== */
function luuDuLieu(){
  localStorage.setItem("huiData", JSON.stringify(data));
}
function taiDuLieu(){
  let d=localStorage.getItem("huiData");
  if(d) data=JSON.parse(d);
}

/* ===== K·ª≤ ===== */
function capNhatKy(){
  let v=parseInt(ky.value); if(v<1)v=1;
  data.ky=v; luuDuLieu(); veBang();
}
function doiKy(s){
  data.ky+=s; if(data.ky<1)data.ky=1;
  ky.value=data.ky; luuDuLieu(); veBang();
}
function capNhatNgay(){
  data.ngay[data.ky]=ngayKhui.value;
  luuDuLieu();
}

/* ===== NG∆Ø·ªúI ===== */
function themNguoi(){
  data.danhSach.push({ten:"Ng∆∞·ªùi "+(data.danhSach.length+1),lichSu:{}});
  luuDuLieu(); veBang();
}
function daChet(n){
  for(let k in n.lichSu) if(n.lichSu[k].daHot) return true;
  return false;
}
function xoaNguoi(i){
  if(daChet(data.danhSach[i])){
    alert("Kh√¥ng xo√° ƒë∆∞·ª£c ch∆∞ng ch·∫øt"); return;
  }
  if(confirm("Xo√° ng∆∞·ªùi n√†y?")){
    data.danhSach.splice(i,1);
    luuDuLieu(); veBang();
  }
}
function resetHui(){
  if(confirm("Reset to√†n b·ªô d√¢y h·ª•i?")){
    data={ky:1,ngay:{},tongHot:{},danhSach:[]};
    luuDuLieu(); veBang();
  }
}

/* ===== ƒê√ìNG / H·ªêT ===== */
function tickDong(i){
  let ls=data.danhSach[i].lichSu[data.ky];
  if(ls) ls.daDong=!ls.daDong;
  luuDuLieu(); veBang();
}

function hotHui(i){
  let k=data.ky;
  if(daChet(data.danhSach[i])){
    alert("Ch∆∞ng n√†y ƒë√£ ch·∫øt"); return;
  }
  for(let n of data.danhSach)
    if(n.lichSu[k]?.daHot){alert("K·ª≥ n√†y ƒë√£ c√≥ ng∆∞·ªùi h·ªët");return;}

  let bo=parseInt(prompt("Nh·∫≠p ti·ªÅn b·ªè thƒÉm (vd 1000000):"));
  if(isNaN(bo)||bo<0||bo>TIEN_HUI){alert("Kh√¥ng h·ª£p l·ªá");return;}

  let tong=0;
  data.danhSach.forEach((n,idx)=>{
    if(!n.lichSu[k])
      n.lichSu[k]={dong:0,boTham:0,daDong:false,daHot:false};

    if(idx===i){
      n.lichSu[k].daHot=true;
      n.lichSu[k].boTham=bo;
      n.lichSu[k].dong=0;
    }else{
      n.lichSu[k].dong=daChet(n)?TIEN_HUI:(TIEN_HUI-bo);
      tong+=n.lichSu[k].dong;
    }
  });

  data.tongHot[k]=tong;
  luuDuLieu();
  alert("üí∞ Ng∆∞·ªùi h·ªët nh·∫≠n: "+tong.toLocaleString()+" ƒë");
  veBang();
}

/* ===== V·∫º ===== */
function veBang(){
  bang.innerHTML="";
  ngayKhui.value=data.ngay[data.ky]||"";

  data.danhSach.forEach((n,i)=>{
    let ls=n.lichSu[data.ky];
    let tr=document.createElement("tr");
    tr.className=daChet(n)?"chet":ls?.daDong?"daDong":"chuaDong";

    tr.innerHTML=`
<td><input value="${n.ten}" oninput="data.danhSach[${i}].ten=this.value;luuDuLieu()"></td>
<td>${ls?`<input type="checkbox" ${ls.daDong?"checked":""} onclick="tickDong(${i})">`:""}</td>
<td>${ls?ls.dong.toLocaleString()+" ƒë":""}</td>
<td>${ls?.boTham?ls.boTham.toLocaleString()+" ƒë":""}</td>
<td>
${ls?.daHot?`<span class="daHot">ƒê√É H·ªêT</span>`:
daChet(n)?`<span class="khoa">CH∆ØNG CH·∫æT</span>`:
`<button class="hot" onclick="hotHui(${i})">H·ªët</button>`}
</td>
<td><button class="xoa" onclick="xoaNguoi(${i})">‚ùå</button></td>`;
    bang.appendChild(tr);
  });

  tongHot.innerHTML=data.tongHot[data.ky]
  ?`üí∞ T·ªïng ti·ªÅn ng∆∞·ªùi h·ªët nh·∫≠n: <b>${data.tongHot[data.ky].toLocaleString()} ƒë</b>`:"";
}

/* ===== IN / XU·∫§T ===== */
function inBill(){
  let w=window.open("","_blank");
  w.document.write(document.body.innerHTML);
  w.document.close();
  setTimeout(()=>w.print(),500);
}

function xuatPDF(){
  let w=window.open("","_blank");
  w.document.write(document.body.innerHTML);
  w.document.close();
}

taiDuLieu();
veBang();
</script>

</body>
</html>
